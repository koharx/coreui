import{jsx as e,jsxs as t}from"react/jsx-runtime";import{createContext as r,useState as o,useCallback as n,useEffect as s,useContext as i,useRef as a}from"react";import{jwtDecode as l}from"jwt-decode";import c from"axios";const u=r(void 0),d=({children:t,apiClient:r})=>{const[i,a]=o({user:null,token:null,isAuthenticated:!1,isLoading:!0,error:null}),c=n(async()=>{try{const e=localStorage.getItem("auth_token");if(!e)return void a(e=>({...e,isLoading:!1}));const t=l(e);a({user:{id:t.sub,email:t.email,name:t.name,roles:t.roles||[],permissions:t.permissions||[]},token:e,isAuthenticated:!0,isLoading:!1,error:null})}catch(e){localStorage.removeItem("auth_token"),a(e=>({...e,isLoading:!1,error:"Invalid token"}))}},[]);s(()=>{c()},[c]);const d=n(async e=>{try{a(e=>({...e,isLoading:!0,error:null}));const t=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error("Login failed");const{token:r}=await t.json();localStorage.setItem("auth_token",r);const o=l(r);a({user:{id:o.sub,email:o.email,name:o.name,roles:o.roles||[],permissions:o.permissions||[]},token:r,isAuthenticated:!0,isLoading:!1,error:null})}catch(e){throw a(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Login failed"})),e}},[]),g=n(()=>{localStorage.removeItem("auth_token"),a({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null})},[]),h=n(async()=>{try{const e=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error("Token refresh failed");const{token:t}=await e.json();localStorage.setItem("auth_token",t);const r=l(t);a(e=>({...e,user:{id:r.sub,email:r.email,name:r.name,roles:r.roles||[],permissions:r.permissions||[]},token:t}))}catch(e){throw g(),e}},[g]),m=n(e=>{var t,r;return(null===(r=null===(t=i.user)||void 0===t?void 0:t.roles)||void 0===r?void 0:r.includes(e))||!1},[i.user]),f=n(e=>{var t,r;return(null===(r=null===(t=i.user)||void 0===t?void 0:t.permissions)||void 0===r?void 0:r.includes(e))||!1},[i.user]);return e(u.Provider,{value:{...i,login:d,logout:g,refreshToken:h,hasRole:m,hasPermission:f},children:t})},g=()=>{const e=i(u);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e};class h{constructor(e){Object.defineProperty(this,"instance",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"token",{enumerable:!0,configurable:!0,writable:!0,value:null}),this.instance=c.create({baseURL:e.baseURL,timeout:e.timeout||1e4,headers:{"Content-Type":"application/json",...e.headers}}),this.setupInterceptors()}setupInterceptors(){this.instance.interceptors.request.use(e=>(this.token&&(e.headers.Authorization=`Bearer ${this.token}`),e),e=>Promise.reject(e)),this.instance.interceptors.response.use(e=>e,async e=>{var t;return 401===(null===(t=e.response)||void 0===t?void 0:t.status)&&(this.token=null),Promise.reject(e)})}setToken(e){this.token=e}transformResponse(e){return{data:e.data,status:e.status,statusText:e.statusText,headers:e.headers}}async get(e,t){const r=await this.instance.get(e,t);return this.transformResponse(r)}async post(e,t,r){const o=await this.instance.post(e,t,r);return this.transformResponse(o)}async put(e,t,r){const o=await this.instance.put(e,t,r);return this.transformResponse(o)}async patch(e,t,r){const o=await this.instance.patch(e,t,r);return this.transformResponse(o)}async delete(e,t){const r=await this.instance.delete(e,t);return this.transformResponse(r)}}const m=e=>new h(e),f=r(void 0),p=({children:t,config:r})=>{const o=new h(r),s=n(async(e,t)=>o.get(e,t),[o]),i=n(async(e,t,r)=>o.post(e,t,r),[o]),a=n(async(e,t,r)=>o.put(e,t,r),[o]),l=n(async(e,t,r)=>o.patch(e,t,r),[o]),c=n(async(e,t)=>o.delete(e,t),[o]);return e(f.Provider,{value:{get:s,post:i,put:a,patch:l,delete:c},children:t})},w=()=>{const e=i(f);if(void 0===e)throw new Error("useApi must be used within an ApiProvider");return e};class b{constructor(e={}){Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logs",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.config={level:"info",enableConsole:!0,enableStorage:!0,maxEntries:1e3,...e}}shouldLog(e){const t=["debug","info","warn","error"],r=this.config.level||"info";return t.indexOf(e)>=t.indexOf(r)}addLog(e){if(this.logs.push(e),this.config.maxEntries&&this.logs.length>this.config.maxEntries&&(this.logs=this.logs.slice(-this.config.maxEntries)),this.config.enableStorage)try{const t=localStorage.getItem("app_logs"),r=t?JSON.parse(t):[];r.push({...e,timestamp:e.timestamp.toISOString()}),this.config.maxEntries&&r.length>this.config.maxEntries&&r.splice(0,r.length-this.config.maxEntries),localStorage.setItem("app_logs",JSON.stringify(r))}catch(e){console.warn("Failed to store log in localStorage:",e)}}log(e,t,r){if(!this.shouldLog(e))return;const o={level:e,message:t,timestamp:new Date,data:r};if(this.addLog(o),this.config.enableConsole){const o="debug"===e?"debug":e;r?console[o](t,r):console[o](t)}}debug(e,t){this.log("debug",e,t)}info(e,t){this.log("info",e,t)}warn(e,t){this.log("warn",e,t)}error(e,t,r){const o={level:"error",message:e,timestamp:new Date,error:t,data:r};this.addLog(o),this.config.enableConsole&&(t?console.error(e,t,r):console.error(e,r))}getLogs(e){return e?this.logs.filter(t=>t.level===e):[...this.logs]}clearLogs(){this.logs=[],this.config.enableStorage&&localStorage.removeItem("app_logs")}}const y=e=>new b(e),v=r(void 0),S=({children:t,config:r})=>{const o=a(new b(r)),s=n((e,t,r)=>{o.current.log(e,t,r)},[]),i=n((e,t)=>{o.current.debug(e,t)},[]),l=n((e,t)=>{o.current.info(e,t)},[]),c=n((e,t)=>{o.current.warn(e,t)},[]),u=n((e,t,r)=>{o.current.error(e,t,r)},[]),d=n(e=>o.current.getLogs(e),[]),g=n(()=>{o.current.clearLogs()},[]);return e(v.Provider,{value:{log:s,debug:i,info:l,warn:c,error:u,getLogs:d,clearLogs:g},children:t})},k=()=>{const e=i(v);if(void 0===e)throw new Error("useLogger must be used within a LoggerProvider");return e},x=r(void 0),L=({children:t,maxAlerts:r=5,defaultDuration:i=5e3})=>{const[a,l]=o([]),c=n(()=>Math.random().toString(36).substr(2,9),[]),u=n(e=>{var t,o;const n=c(),s={...e,id:n,timestamp:new Date,duration:null!==(t=e.duration)&&void 0!==t?t:i,dismissible:null===(o=e.dismissible)||void 0===o||o};return l(e=>[...e,s].slice(-r)),n},[c,i,r]),d=n((e,t,r)=>u({type:"success",title:e,message:t||"",...r}),[u]),g=n((e,t,r)=>u({type:"error",title:e,message:t||"",...r}),[u]),h=n((e,t,r)=>u({type:"warning",title:e,message:t||"",...r}),[u]),m=n((e,t,r)=>u({type:"info",title:e,message:t||"",...r}),[u]),f=n(e=>{l(t=>t.filter(t=>t.id!==e))},[]),p=n(()=>{l([])},[]);return s(()=>{const e=[];return a.forEach(t=>{if(t.duration&&t.duration>0){const r=setTimeout(()=>{f(t.id)},t.duration);e.push(r)}}),()=>{e.forEach(e=>clearTimeout(e))}},[a,f]),e(x.Provider,{value:{alerts:a,showAlert:u,showSuccess:d,showError:g,showWarning:h,showInfo:m,dismissAlert:f,clearAlerts:p},children:t})},E=()=>{const e=i(x);if(void 0===e)throw new Error("useAlert must be used within an AlertProvider");return e},I=e=>{const t={padding:"12px 16px",borderRadius:"6px",marginBottom:"8px",border:"1px solid",display:"flex",justifyContent:"space-between",alignItems:"flex-start",minWidth:"300px",maxWidth:"400px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)"};switch(e){case"success":return{...t,backgroundColor:"#d4edda",borderColor:"#c3e6cb",color:"#155724"};case"error":return{...t,backgroundColor:"#f8d7da",borderColor:"#f5c6cb",color:"#721c24"};case"warning":return{...t,backgroundColor:"#fff3cd",borderColor:"#ffeaa7",color:"#856404"};case"info":return{...t,backgroundColor:"#d1ecf1",borderColor:"#bee5eb",color:"#0c5460"};default:return t}},O=({position:r="top-right",className:o=""})=>{const{alerts:n,dismissAlert:s}=E(),i=(e=>{const t={position:"fixed",zIndex:9999,padding:"16px",pointerEvents:"none"};switch(e){case"top-right":default:return{...t,top:0,right:0};case"top-left":return{...t,top:0,left:0};case"bottom-right":return{...t,bottom:0,right:0};case"bottom-left":return{...t,bottom:0,left:0};case"top-center":return{...t,top:0,left:"50%",transform:"translateX(-50%)"};case"bottom-center":return{...t,bottom:0,left:"50%",transform:"translateX(-50%)"}}})(r);return t("div",{style:i,className:o,children:[n.map(r=>t("div",{style:{...I(r.type),pointerEvents:"auto",animation:"slideIn 0.3s ease-out"},children:[t("div",{style:{flex:1},children:[e("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:r.title}),r.message&&e("div",{style:{fontSize:"14px",lineHeight:"1.4"},children:r.message})]}),r.dismissible&&e("button",{onClick:()=>s(r.id),style:{background:"none",border:"none",fontSize:"18px",cursor:"pointer",marginLeft:"12px",color:"inherit",opacity:.7},"aria-label":"Dismiss alert",children:"Ã—"})]},r.id)),e("style",{children:"\n          @keyframes slideIn {\n            from {\n              transform: translateX(100%);\n              opacity: 0;\n            }\n            to {\n              transform: translateX(0);\n              opacity: 1;\n            }\n          }\n        "})]})};function C(e,t){const[r,i]=o(()=>{if("undefined"==typeof window)return t;try{const r=window.localStorage.getItem(e);return r?JSON.parse(r):t}catch(r){return console.warn(`Error reading localStorage key "${e}":`,r),t}}),a=n(t=>{try{const o=t instanceof Function?t(r):t;i(o),"undefined"!=typeof window&&window.localStorage.setItem(e,JSON.stringify(o))}catch(t){console.warn(`Error setting localStorage key "${e}":`,t)}},[e,r]);return s(()=>{if("undefined"==typeof window)return;const t=t=>{if(t.key===e&&null!==t.newValue)try{i(JSON.parse(t.newValue))}catch(t){console.warn(`Error parsing localStorage key "${e}":`,t)}};return window.addEventListener("storage",t),()=>window.removeEventListener("storage",t)},[e]),[r,a]}function P(e,t){const[r,i]=o(()=>{if("undefined"==typeof window)return t;try{const r=window.sessionStorage.getItem(e);return r?JSON.parse(r):t}catch(r){return console.warn(`Error reading sessionStorage key "${e}":`,r),t}}),a=n(t=>{try{const o=t instanceof Function?t(r):t;i(o),"undefined"!=typeof window&&window.sessionStorage.setItem(e,JSON.stringify(o))}catch(t){console.warn(`Error setting sessionStorage key "${e}":`,t)}},[e,r]);return s(()=>{if("undefined"==typeof window)return;const t=t=>{if(t.key===e&&null!==t.newValue)try{i(JSON.parse(t.newValue))}catch(t){console.warn(`Error parsing sessionStorage key "${e}":`,t)}};return window.addEventListener("storage",t),()=>window.removeEventListener("storage",t)},[e]),[r,a]}function A(e,t){const[r,n]=o(e);return s(()=>{const r=setTimeout(()=>{n(e)},t);return()=>{clearTimeout(r)}},[e,t]),r}function T(e,t){const[r,n]=o(e),i=a(Date.now());return s(()=>{const r=setTimeout(()=>{const r=Date.now();r-i.current>=t&&(n(e),i.current=r)},t-(Date.now()-i.current));return()=>{clearTimeout(r)}},[e,t]),r}export{O as AlertContainer,L as AlertProvider,p as ApiProvider,d as AuthProvider,S as LoggerProvider,m as createApiClient,y as createLogger,E as useAlert,w as useApi,g as useAuth,A as useDebounce,C as useLocalStorage,k as useLogger,P as useSessionStorage,T as useThrottle};
//# sourceMappingURL=index.esm.js.map
